# name: test/sql/mlpack_logistic_regression.test
# description: test logistic_regression in mlpack extension
# group: [sql]

require mlpack

statement ok
PRAGMA enable_verification

# running commands from sampleCall.sh 

statement ok
CREATE TABLE X AS SELECT * FROM read_csv("docs/data/logistic_x.csv");

statement ok
CREATE TABLE Y AS SELECT * FROM read_csv("docs/data/logistic_y.csv");

statement ok
CREATE TABLE Z (name VARCHAR, value VARCHAR);

statement ok
INSERT INTO Z VALUES ('silent', 'true');

statement ok
CREATE TABLE M (key VARCHAR, json VARCHAR);

statement ok
SELECT * FROM mlpack_logistic_regression_fit("X", "Y", "Z", "M");

statement ok
SELECT * FROM M WHERE key = 'coefficients';

statement ok
CREATE TABLE N (x1 DOUBLE, x2 DOUBLE);

statement ok
INSERT INTO N VALUES ('1', '1'), ('2', '-1'), ('3', '1');

statement ok
SELECT * FROM mlpack_logistic_regression_pred("N", "M");

query I
SELECT * FROM mlpack_logistic_regression_pred("N", "M");
----
1
0
1

# NB we declare 'json' as a dependency in 'extension_config.cmake' so it should be present
# The require will result in skipping the remainder where json may be unavailable 
require json

query I
SELECT unnest( json_extract( json, '$.parameters[*]'))::FLOAT AS parameters FROM M WHERE key = 'coefficients' LIMIT 3;
----
-1.0327032
0.5609258
1.0829775

