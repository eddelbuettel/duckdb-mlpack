# name: test/sql/mlpack_linear_regression.test
# description: test linear_regression in mlpack extension
# group: [sql]

require mlpack

statement ok
PRAGMA enable_verification

# check mlpack_adaboost
# running commands from sampleCall.sh 

statement ok
CREATE TABLE X AS SELECT * FROM read_csv("docs/data/trees_x.csv");

statement ok
CREATE TABLE Y AS SELECT * FROM read_csv("docs/data/trees_y.csv");

statement ok
CREATE TABLE Z (name VARCHAR, value VARCHAR);

statement ok
INSERT INTO Z VALUES ('intercept', 'true'), ('silent', 'true');

statement ok
CREATE TABLE M (key VARCHAR, json VARCHAR);

statement ok
SELECT * FROM mlpack_linear_regression_fit("X", "Y", "Z", "M");

statement ok
SELECT * FROM M WHERE key = 'coefficients';

# NB we declared 'json' as a dependency in 'extension_config.cmake'
require json

statement ok
CREATE TABLE N (x1 DOUBLE, x2 DOUBLE);

statement ok
INSERT INTO N VALUES ('1', '1'), ('2', '-1'), ('3', '1');

statement ok
SELECT * FROM mlpack_linear_regression_pred("N", "M");

query I
SELECT * FROM mlpack_linear_regression_pred("N", "M");
----
-3.531843882442646
-3.7834406384184
0.43345593812695693

# NB we declare 'json' as a dependency in 'extension_config.cmake' so it should be present
# The require will result in skipping the remainder where json may be unavailable 
require json

query I
SELECT unnest( json_extract( json, '$.parameters[*]'))::FLOAT AS parameters FROM M WHERE key = 'coefficients' LIMIT 3;
----
-6.631617
1.9826499
1.1171234
