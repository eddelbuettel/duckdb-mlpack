# name: test/sql/mlpack.test
# description: test mlpack extension
# group: [sql]

# Before we load the extension, this will fail
statement error
SELECT mlpack('Sam');
----
Catalog Error: Scalar Function with name mlpack does not exist!

# Require statement will ensure this test is run with this extension loaded
require mlpack

# check mlpack_table
statement ok
SELECT * FROM mlpack_table(42);

# this added tabs between columns
query IIIII
SELECT * FROM mlpack_table(42);
----
42	43	44	45.0	46.0
47	48	49	50.0	51.0
52	53	54	55.0	56.0

# this avoids the tabs
query I
select list_value(col_1, col_2, col_3, col_4, col_5) as val from (select * from mlpack_table(42))
----
[42.0, 43.0, 44.0, 45.0, 46.0]
[47.0, 48.0, 49.0, 50.0, 51.0]
[52.0, 53.0, 54.0, 55.0, 56.0]


# check mlpack_adaboost
# running commands from sampleCall.sh 
statement ok
CREATE TABLE X AS SELECT * FROM read_csv("docs/data/iris.csv");

statement ok
CREATE TABLE Y AS SELECT * FROM read_csv("docs/data/iris_labels.csv");

statement ok
CREATE TABLE Z (name VARCHAR, value VARCHAR);

statement ok
INSERT INTO Z VALUES ('iterations', '50'), ('tolerance', '1e-7'), ('silent', 'true');

statement ok
CREATE TABLE M (key VARCHAR, json VARCHAR);

statement ok
CREATE TEMP TABLE A AS SELECT * FROM mlpack_adaboost_train("X", "Y", "Z", "M");

query II
SELECT COUNT(*) as n, predicted FROM A GROUP BY predicted;
----
50	0
49	1
51	2

statement ok
CREATE TABLE N (x1 DOUBLE, x2 DOUBLE, x3 DOUBLE, x4 DOUBLE);

statement ok
INSERT INTO N VALUES (5.843, 3.054, 3.759, 1.199), (4.3, 2.0, 1.0, 0.1), (7.9, 4.4, 6.9, 2.5);

statement ok
CREATE TEMP TABLE B AS SELECT * FROM mlpack_adaboost_pred("N", "M");

query I
SELECT * FROM B;
----
1
0
2

query II
SELECT COUNT(*) as n, predicted FROM B GROUP BY predicted;
----
1	0
1	1
1	2

